<?php

// Database connection settings
$servername = "localhost";
$username = "root";
$password = "";
$dbname = "yousef_db2";

// Create connection
$conn = new mysqli($servername, $username, $password, $dbname);

// Check connection
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

// Get migration files from the output of migrate:status
$migrations = [
    // Core migrations
    "0001_01_01_000001_create_cache_table",
    "0001_01_01_000002_create_jobs_table",
    "2023_05_01_000000_create_courses_table",
    "2023_06_26_000000_add_last_message_at_to_chats_table",
    "2023_06_27_000000_add_missing_columns_to_chats_table",
    "2023_07_01_000001_create_instructor_earnings_table",
    
    // Application migrations
    "2025_03_28_054158_create_users_table",
    "2025_03_28_054226_create_user_roles_table",
    "2025_03_28_054322_update_categories_table",
    "2025_03_28_054427_create_users_table",
    "2025_03_28_054511_create_user_roles_table",
    "2025_03_28_054545_create_categories_table",
    "2025_03_28_054624_create_courses_table",
    "2025_03_28_054656_create_course_videos_table",
    "2025_03_28_054737_create_course_materials_table",
    "2025_03_28_054926_create_enrollments_table",
    "2025_03_28_055010_create_ratings_table",
    "2025_03_28_055959_create_payments_table",
    "2025_03_28_060038_create_coupons_table",
    "2025_03_28_060128_create_payment_coupons_table",
    "2025_03_28_060202_create_chats_table",
    "2025_03_28_060503_create_parent_student_table",
    "2025_03_28_060528_create_student_progress_table",
    "2025_03_28_060700_create_system_settings_table",
    "2025_03_28_060726_create_withdrawals_table",
    "2025_03_28_060907_create_exams_table",
    "2025_03_28_060945_create_notifications_table",
    "2025_03_28_061113_create_financial_ledger_table",
    "2025_03_28_063343_create_coupons_table",
    "2025_03_28_065540_create_chat_tables",
    "2025_03_28_070000_add_approval_feedback_to_courses_table",
    "2025_03_28_080000_create_course_materials_table",
    "2025_03_28_090000_create_enrollments_table",
    "2025_03_28_100000_create_ratings_table",
    "2025_03_28_120210_create_instructor_verifications_table",
    "2025_04_03_180723_create_courses_table_fixed",
    "2025_04_03_200000_create_enrollments_table_fixed",
    "2025_04_03_210000_create_ratings_table_fixed",
    "2025_04_03_220000_create_course_materials_table_fixed",
    "2025_04_03_230000_create_instructor_verifications_table_fixed",
    "2025_04_03_240000_fix_categories_table",
    "2025_04_03_250000_fix_all_tables",
    "2025_04_04_000000_create_missing_tables",
    "2025_04_04_072246_rename_enrollment_date_to_enrolled_at_in_enrollments_table",
    "2025_04_04_072730_rename_enrollment_date_to_enrolled_at_in_enrollments_table",
    "2025_04_04_100000_create_course_reviews_table",
    "2025_04_04_142308_add_is_published_to_exams_table",
    "2025_04_04_143552_create_exam_attempts_table",
    "2025_04_04_151559_add_admin_notes_to_instructor_verifications_table",
    "2025_04_04_155339_create_messages_table",
    "2025_04_04_200000_create_chat_participants_table",
    "2025_04_05_add_completion_date_to_enrollments",
    "2025_04_05_add_progress_to_enrollments",
    "2025_04_05_add_student_id_to_student_progress",
    "2025_04_05_create_payments_table",
    "2025_04_05_create_settings_table",
    "2025_04_05_create_student_progress_table",
    "2025_04_05_create_transactions_table",
    "2025_04_05_update_payments_table",
    "2025_04_06_update_payment_methods",
    "2025_04_07_update_payment_methods_paymob_only",
    "2025_04_17_232617_create_personal_access_tokens_table",
    "2025_04_18_000000_update_course_videos_table",
    "2025_04_18_151640_update_course_videos_allow_null_url",
    "2025_04_18_155109_create_announcements_table",
    "2025_04_20_000001_create_instructor_payment_accounts_table",
    "2025_04_20_000002_create_instructor_earnings_table",
    "2025_04_20_000003_add_commission_settings",
    "2025_04_21_000001_add_payment_details_to_instructor_verifications",
    "2025_04_23_021916_add_storage_disk_to_course_videos_table",
    "2025_04_28_033319_create_course_sections_table",
    "2025_04_28_034640_add_position_to_course_videos_table",
    "2025_04_29_065020_create_website_appearances_table",
    "2025_04_30_082216_create_password_reset_tokens_table",
    "2025_05_01_000000_create_video_access_table",
    "2025_05_01_000001_create_video_views_table",
    "2025_05_01_000002_add_is_encrypted_to_course_videos",
    "2025_05_01_000003_add_fingerprint_to_video_access",
    "2025_05_01_000004_create_download_attempts_table",
    "2025_05_01_050828_create_quizzes_table",
    "2025_05_01_050843_create_quiz_attempts_table",
    "2025_05_02_000000_add_certificate_available_to_courses_table",
    "2025_05_02_000001_create_certificates_table",
    "2025_05_04_015814_create_discounts_table",
    "2025_05_04_021846_create_coupons_table",
    "2025_05_04_205524_create_parent_student_relations_table",
    "2025_05_05_134517_update_parent_student_relations_foreign_keys",
    "2025_05_06_034617_add_default_payment_method_to_settings",
    "2025_05_06_044754_add_student_id_to_payments_table",
    "2025_05_07_043839_add_detailed_description_to_users_table",
    "2025_05_07_044749_add_website_field_to_users_table",
    "2025_05_07_093427_add_user_id_to_messages_table",
    "2025_05_08_000843_add_score_percentage_to_quiz_attempts_table",
    "2025_05_08_000917_add_correct_answers_count_to_quiz_attempts_table",
    "2025_05_08_001748_add_status_to_courses_table",
    "2025_05_08_001805_add_approval_status_to_courses_table",
    "2025_05_08_072711_add_hls_fields_to_course_videos",
    "2025_05_08_105037_add_payment_date_to_payments_table",
    "2025_05_08_111659_add_notes_to_payments_table",
    "2025_05_08_112359_add_payment_details_to_payments_table",
    "2025_05_08_112943_modify_user_id_in_payments_table",
    "2025_05_08_113353_add_student_id_to_payments_table",
    "2025_05_08_113510_add_student_id_foreign_key_to_payments_table",
    "2025_05_09_064808_add_token_to_parent_student_relations_table",
    "2025_05_09_070541_create_student_activities_table",
    "2025_05_09_070934_add_available_to_column_to_exams_table",
    "2025_05_09_071042_add_available_from_column_to_exams_table",
    "2025_05_09_072218_create_course_contents_table",
    "2025_05_09_073308_create_student_progress_table",
    "2025_05_09_074258_add_columns_to_student_progress",
    "2025_05_09_094645_add_coupon_fields_to_payments_table",
    "2025_05_10_000000_add_status_column_to_exam_attempts_table",
    "2025_05_10_052156_add_certificate_fields_to_courses_table",
    "2025_05_10_053714_add_payment_fields_to_withdrawals_table",
    "2025_05_10_120858_update_withdrawals_status_enum",
    "2025_05_13_073532_add_banner_image_to_users_table",
    "2025_05_13_110923_create_banned_words_table",
    "2025_05_13_124149_create_admin_notifications_table",
    "2025_05_14_000000_add_content_filtering_columns_to_messages",
    "2025_05_14_000000_ensure_student_progress_structure",
    "2025_05_14_085925_add_verified_by_to_parent_student_relations",
    "2025_05_14_090258_create_notifications_table",
    "2025_05_14_090748_update_notifications_table_structure",
    "2025_05_14_093407_create_sessions_table",
    "2025_05_14_094350_update_notifications_table_structure",
    "2025_05_14_094806_add_severity_to_admin_notifications_table",
    "2025_05_14_113544_add_reviewed_at_to_instructor_verifications_table",
    "2025_05_14_113900_add_sequence_order_to_course_videos_table",
    "2025_05_14_114108_add_duration_seconds_to_course_videos_table",
    "2025_05_14_114443_add_file_url_to_course_materials_table",
    "2025_05_14_115624_add_is_free_preview_to_course_videos_table",
    "2025_05_14_115801_add_remaining_columns_to_course_videos_table",
    "2025_05_14_115848_add_missing_columns_to_course_videos_table",
    "2025_05_14_120041_add_file_path_to_course_materials_table",
    "2025_05_14_120150_modify_file_path_in_course_materials_table",
    "2025_05_14_120633_create_exams_table",
    "2025_05_14_120735_create_exam_attempts_table",
    "2025_05_14_121239_create_quizzes_table",
    "2025_05_14_121300_create_quiz_attempts_table",
    "2025_05_14_121513_add_duration_minutes_to_quizzes_table",
    "2025_05_14_122131_add_passing_percentage_to_quizzes_table",
    "2025_05_14_122544_add_is_active_to_quizzes_table",
    "2025_05_14_122820_add_created_by_to_quizzes_table",
    "2025_05_14_122947_add_remaining_columns_to_quizzes_table",
    "add_default_users",
    "add_footer_to_website_appearances",
    "add_section_to_website_appearances",
    "fix_admin_notifications_table",
    "fix_categories_table",
    "fix_certificates_table",
    "fix_chats_table",
    "fix_coupons_table",
    "fix_course_materials_table",
    "fix_course_sections_table",
    "fix_course_videos_table",
    "fix_courses_table",
    "fix_enrollments_table",
    "fix_instructor_verifications_table",
    "fix_messages_table",
    "fix_notifications_table",
    "fix_parent_student_relations_table",
    "fix_payments_table",
    "fix_quiz_attempts_table",
    "fix_quizzes_table",
    "fix_ratings_table",
    "fix_settings_table",
    "fix_student_activities_table",
    "fix_student_progress_table",
    "fix_user_roles_table",
    "fix_users_table",
    "fix_website_appearances_table",
    "fix_withdrawals_table"
];

// Empty the migrations table first
$conn->query("TRUNCATE TABLE migrations");

// Insert migrations with sequential batch numbers
$batch = 1;
foreach ($migrations as $migration) {
    $stmt = $conn->prepare("INSERT INTO migrations (migration, batch) VALUES (?, ?)");
    $stmt->bind_param("si", $migration, $batch);
    $stmt->execute();
    $stmt->close();
}

echo "Migrations table updated with " . count($migrations) . " migrations in batch $batch.";

$conn->close(); 